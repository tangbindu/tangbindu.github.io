function findIcon(t,i,e){function r(t,e){var n={x:t.x,y:t.y-1},a={x:t.x+1,y:t.y},h={x:t.x,y:t.y+1},o={x:t.x-1,y:t.y},x={x:t.x-1,y:t.y-1},y={x:t.x+1,y:t.y-1},c={x:t.x-1,y:t.y+1},g={x:t.x+1,y:t.y+1};try{var s=i[n.y][n.x];2==s&&(i[n.y][n.x]=e,r(n,e))}catch(f){}try{var l=i[a.y][a.x];2==l&&(i[a.y][a.x]=e,r(a,e))}catch(f){}try{var d=i[h.y][h.x];2==d&&(i[h.y][h.x]=e,r(h,e))}catch(f){}try{var v=i[o.y][o.x];2==v&&(i[o.y][o.x]=e,r(o,e))}catch(f){}try{var u=i[x.y][x.x];2==u&&(i[x.y][x.x]=e,r(x,e))}catch(f){}try{var m=i[y.y][y.x];2==m&&(i[y.y][y.x]=e,r(y,e))}catch(f){}try{var p=i[c.y][c.x];2==p&&(i[c.y][c.x]=e,r(c,e))}catch(f){}try{var w=i[g.y][g.x];2==w&&(i[g.y][g.x]=e,r(g,e))}catch(f){}}function n(t,i){var e=[];for(y=i.top;y<i.bottom;y++){var r=[];for(x=i.left;x<i.right;x++)r.push(t[y][x]);e.push(r)}return e}function a(r){var a=[],h={top:0,right:0,bottom:0,left:0,data:null,flag:r};for(y=0;y<t.height;y++)for(x=0;x<t.width;x++)i[y][x]==r&&a.push({y:y,x:x});return a.sort(function(t,i){return t.x-i.x}),h.left=a[0].x,h.right=a[a.length-1].x+1-2*e,a.sort(function(t,i){return t.y-i.y}),h.top=a[0].y,h.bottom=a[a.length-1].y+1-2*e,h.data=n(i,h),h}{var h=2;t.width,t.height}for(time=0,y=0;y<i.length;y++)for(x=0;x<i[y].length;x++){{0==i[y][x-1]?!0:!1}2!=i[y][x]||i[y][x-1]?2==i[y][x]&&i[y][x-1]&&(i[y][x]=1,r({x:x,y:y},1)):(i[y][x]=++h,r({x:x,y:y},h))}for(var o=[],c=3;h>=c;c++)o.push(a(c));return o}function findBorder(t){for(var i=[],e=0;e<t.length;e++)for(var r=0;r<t[e].length;r++)if(1==t[e][r]){try{i[0]=t[e-1][r-1]}catch(n){i[0]=0}try{i[1]=t[e][r-1]}catch(n){i[1]=0}try{i[2]=t[e+1][r-1]}catch(n){i[2]=0}try{i[3]=t[e-1][r]}catch(n){i[3]=0}try{i[4]=t[e+1][r]}catch(n){i[4]=0}try{i[5]=t[e-1][r+1]}catch(n){i[5]=0}try{i[6]=t[e][r+1]}catch(n){i[6]=0}try{i[7]=t[e+1][r+1]}catch(n){i[7]=0}for(var a=0;a<i.length;a++)if(0==i[a]||void 0==i[a]){t[e][r]=2;break}}}function biggerIcon(t,i){function e(e,r){for(var n=-1*i;i>=n;n++)for(var a=-1*i;i>=a;a++)2!=t[e-0+n][r-0+a]&&(t[e-0+n][r-0+a]=1)}for(var r=0;r<t.length;r++)for(var n=0;n<t[r].length;n++)2==t[r][n]&&e(r,n);for(var r=0;r<t.length;r++)for(var n=0;n<t[r].length;n++)2==t[r][n]&&(t[r][n]=1)}function Icon(t,i){this.imgData=t,this.piex2D=[],this.img=null,this.width=null,this.height=null,this.piex=null,this.fixed=10,this.boxes=[],this.canvas=null;$.extend(this,i)}util={show2D:function(t){for(var i=0;i<t.length;i++){for(var e="",r=0;r<t[i].length;r++)e+=t[i][r]+"";e+="list"+i,console.log(e)}},show_g_loading:function(){$("#stage").addClass("g-loading-show")},hide_g_loading:function(){$("#stage").removeClass("g-loading-show")},isChrome:function(){var t=navigator.userAgent,i=new RegExp("chrome","i");0==i.test(t)&&(document.body.style["background-color"]="black",document.body.innerHTML="",setTimeout(function(){alert("亲，请使用chrome浏览器玩耍哦！")},1e3))}},util.isChrome(),Icon.prototype={init:function(t){var i,e=this;e.img=new Image,e.img.onload=function(){e.width=e.img.width,e.height=e.img.height,e.canvas=document.createElement("canvas"),i=e.canvas.getContext("2d"),e.canvas.width=e.width+2*e.fixed,e.canvas.height=e.height+2*e.fixed;(new Date).getTime();i.drawImage(e.img,e.fixed,e.fixed,e.width,e.height),e.piex=i.getImageData(0,0,e.canvas.width,e.canvas.height).data,e.piexTo2D(),findBorder(e.piex2D),biggerIcon(e.piex2D,e.fixed),findBorder(e.piex2D),e.boxes=findIcon(e.canvas,e.piex2D,e.fixed),t&&t.call(e)},e.img.src=this.imgData},piexTo2D:function(){var t=0,i=0,e=0,r=[];for(t;t<this.piex.length;t+=4){var n=this.piex[t],a=this.piex[t+1],h=this.piex[t+2],o=this.piex[t+3];r[i++]=this.isPiex(n,a,h,o)?1:0}for(y=0;y<this.canvas.height;y++)for(this.piex2D[y]=[],x=0;x<this.canvas.width;x++){var c=r[e++];this.piex2D[y][x]=c}},isPiex:function(t,i,e,r){return t|i|e|r}};